<!DOCTYPE html>

<!--
  Google HTML5 slide template

  Authors: Luke Mahé (code)
           Marcin Wichary (code and design)
           
           Dominic Mazzoni (browser compatibility)
           Charles Chen (ChromeVox support)

  URL: http://code.google.com/p/html5slides/
-->

<html>
  <head>
    <meta name="description" content="Closure Library">
    <meta name="author" content="Sebastian Poręba">

    <meta charset='utf-8'>
    <script src='slides.js'></script>
    <title>Closure Library - Sebastian Poręba</title>

  
  <style>
    
    .prettyprint .red .typ, .prettyprint .red .atn, .prettyprint .red .dec, .prettyprint .red .kwd,
    .prettyprint .red .var, .prettyprint .red .str, .prettyprint .red .pun, .prettyprint .red .pln {
      color: #f00 !important;
    }

    a.red {
        color: #f00 !important;
    }

  </style>
  </head>
  <body style='display: none'>
  <script type="text/javascript">

//    var _gaq = _gaq || [];
//    _gaq.push(['_setAccount', 'UA-17195095-1']);
//    _gaq.push(['_trackPageview']);

//    (function() {
//      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
//      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
//      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
//    })();

  </script>
    <section class='slides layout-regular template-default'>

      <article>
        <h1>
          Closure Library, Compiler and Plovr
        </h1>
        <p>
          Sebastian Poręba
          <br>
          28th June 2011
        </p>
      </article>
      
	  <article>
		<h2>What makes web slow?</h2>
	  </article>
	  
	  <article>
		<h2>Page load time = code download + code parsing + code execution</h2>
	  </article>
	  
	  <article>
		<h2>Moore's law doesn't apply to programmers.</h2>
	  </article>
	  
	  <article>
          <h2>Writing fast code requires a lot of effort!</h2>
	  </article>

	  <article>
		<h2>JavaScript has its quirks = even more work</h2>
	  </article>	 
	  
	  <article>
		<h2>How to improve development time and application performance?</h2>
	  </article>
	  
	  <article>
		<h2>Automated code processing and optimization!</h2>
		
		<ul>
			<li>CoffeeScript</li>
			<li>LASS, SASS</li>
			<li>Code minifiers</li>
			<li>JSLint, JSHint</li>
			<li>Unit testing</li>
		</ul>
	  </article>
	  
	  <article>
		<h2>Google Closure is a complete toolchain for building big, fast applications with less effort</li>
	  </article>

	  <article>
		<h1>Closure Compiler</h1>
	  </article>

      <article>
        <h3>Easy modules</h3>

<pre>
    goog.provide('my.delicious.Cookie');
</pre>

<pre>
    goog.require('goog.dom');
    goog.require('goog.net.xhrio');
</pre>
      </article>

      <article>
        <h3>closurebuilder.py - concat all required files</h3>
        <img class="centered big" style="margin-top: 50px !important; height: 80%;" src="images/calcdeps-1.jpg">
      </article>
            
      <article>
        <h3>closurebuilder.py - concat all required files</h3>
        <img class="centered big" style="margin-top: 50px !important; height: 80%;" src="images/calcdeps-2.jpg">
      </article>
      
      <article>
        <h3>closurebuilder.py - concat all required files</h3>
        <img class="centered big" style="margin-top: 50px !important; height: 80%;" src="images/calcdeps-3.jpg">
      </article>

      <article>
        <h3>Compiler - remove unused function and variables</h3>
        <img class="centered big" style="margin-top: 50px !important; height: 50%;" src="images/gcc-advanced-deps.jpg">
      </article>

      <article>
        <h3>Compiler - remove unused function and variables</h3>
        <img class="centered big" style="margin-top: 50px !important; height: 50%;" src="images/gcc-advanced-deps-optimized.jpg">
      </article>

      <article>
          <h2>The Closure Way - use as bloated structure as it suits you, then optimize like crazy</h2>
      </article>

      <article>
          <h2>Is it hard to configure?</h2>
      </article>

      <article>
          <h2>Demo time!</h2>
      </article>

<!-- demo 1 no js -->


      <article>
          <h3>No JS demo</h3>

          <a href="index/nojs">Click here!</a>
      </article>

      <article>
          <h3>No JS demo</h3>

          First load:
          <ul>
              <li>JS - 0kB/0ms</li>
              <li>HTML - 216kB/600ms</li>
          </ul>

          Page load:
          <ul>
              <li>JS - 0kB/0ms</li>
              <li>HTML - 216kB/600ms</li>
          </ul>
      </article>

      <!-- demo 2 jQuery pagination demo -->


      <article>
          <h3>jQuery pagination demo</h3>

          Static HTML sucks!<br>Lets add jQuery and create AJAX pagination.<br>

          <a href="/index/jquerypagination">Click here!</a>
      </article>

      <article>
          <h3>jQuery pagination demo</h3>

          First load:
          <ul>
              <li>JS - 93kB/920ms</li>
              <li>HTML - 3+215kB/700ms</li>
          </ul>

          Page load:
          <ul>
              <li>HTML - 215kB/350ms</li>
          </ul>
      </article>

      <article>
          <h3>jQuery pagination demo</h3>
<pre>
$(document).ready(function() {
    var loaddata = function(e) {
        $('#table-contents').load('/index/paginationhtml');
        if(e) {
            e.preventDefault();
        }
        return false;
    };
    $('#next-page').click(loaddata);
    loaddata();
});
</pre>
      </article>

      <!-- demo 2 Google Closure pagination demo -->


      <article>
          <h3>Google Closure pagination demo</h3>

          Replace jQuery with Google Closure<br>

          <a href="/index/closurepagination">Click here!</a>
      </article>

      <article>
          <h3>Google Closure pagination demo</h3>

          First load:
          <ul>
              <li>JS - 910kB/8500ms <span class="red">WTF?</span></li>
              <li>HTML - 3+215kB/700ms</li>
          </ul>

          Page load:
          <ul>
              <li>HTML - 215kB/350ms</li>
          </ul>
      </article>

      <article>
          <h3>Google Closure pagination demo</h3>

<pre>
/**
 * @constructor
 */
prezentacja.Start1 = function() {
var button = goog.dom.getElement('next-page');
var table = goog.dom.getElement('table-contents');

/**
 * @type {prezentacja.Loader}
 * @private
 */
this.loader_ = new prezentacja.Loader();

goog.events.listen(button, goog.events.EventType.CLICK, function(e) {
    this.loader_.loadNewPageHtml(table);
    e.preventDefault();
}, false, this);

this.loader_.loadNewPageHtml(table);
};
</pre>
      </article>
      <article>
          <h3>Google Closure pagination demo</h3>

<pre>
/**
 * @constructor
 */
prezentacja.Loader = function() {};

prezentacja.Loader.prototype.loadNewPageHtml = function(target) {
var xhr_ = new goog.net.XhrIo();

goog.events.listen(xhr_, goog.net.EventType.COMPLETE, function(e) {
    var html = this.getResponseText();
    target.innerHTML = html;
});

xhr_.send('/index/paginationhtml');
};
</pre>
      </article>

	  <article>
		<h3>Plovr config - simple</h3>
<pre>
{
  "id": "prezentacja",
  "paths": "src",

  "inputs": "src/start-1.js",

  "mode": "RAW",
  "level": "VERBOSE",

  "checks": {
    "deprecated": "ERROR",
    "checkTypes": "ERROR",
    "nonStandardJsDocs": "ERROR"
  }
}
</pre>
	  </article>

      <article>
          <h3>How to run plovr?</h3>
          Serve mode:
<pre>
java -jar plovr.jar serve config1.js config2.js config3.js
</pre>
          Build mode:
<pre>
java -jar plovr.jar build config1.js
</pre>

      <a href="http://localhost:9810">Demo plovr</a>

      </article>

      <!-- demo 3 Google Closure compiled pagination demo -->


      <article>
          <h3>Google Closure compiled pagination demo</h3>

          Switch compilation mode to advanced!<br>

          <a href="/index/closurecompilation">Click here!</a>
      </article>


      <article>
          <h3>Google Closure compiled pagination demo</h3>

          First load:
          <ul>
              <li class="red">JS - 19kB/350ms (98% reduction!)</li>
              <li>HTML - 3+215kB/700ms</li>
          </ul>

          Page load:
          <ul>
              <li>HTML - 215kB/350ms</li>
          </ul>
      </article>

      <article>
          <h2>So much better than jQuery!</h2>
      </article>

      <article>
          <h2>Usually expect code size reduction around 70-80%</h2>
      </article>

      <article>
		<h3>Plovr config - advanced compilation</h3>
<pre>
{
  "id": "prezentacja2",
  "paths": "src",
  "inputs": "src/start-1.js",

<span class="red">
  "mode": "ADVANCED",
  "level": "QUIET",
</span>
  "checks": {
    "deprecated": "ERROR",
    "checkTypes": "ERROR",
    "nonStandardJsDocs": "ERROR"
  }
}
</pre>
	  </article>


      <!-- demo 4 Google Closure Soy demo -->


      <article>
          <h3>Google Closure compiled + soy demo</h3>

          HTML is so bloated! Lets send JSON instead.<br>

          <a href="/index/templates">Click here!</a>
      </article>

      <article>
          <h3>Google Closure compiled + soy demo</h3>

          First load:
          <ul>
              <li>JS - 21kB/270ms</li>
              <li>JSON - 38kB/300ms</li>
              <li>HTML - 3/470ms</li>
          </ul>

          Page load:
          <ul>
              <li class="red">JSON - 38kB/300ms</li>
          </ul>
      </article>

      <article>
          <h3>Google Closure compiled + soy demo</h3>

<pre>
prezentacja.Loader.prototype.loadNewPageJSON = function(target) {
var xhr_ = new goog.net.XhrIo();

goog.events.listen(xhr_, goog.net.EventType.COMPLETE, function(e) {
var json = this.getResponseJson();
<span class="red">
var translated_json = prezentacja.Model.getInstance().importer(json);
</span>
target.innerHTML = prezentacja.templates.Table.table({
    data: translated_json
});
});

xhr_.send('/index/paginationjson');
};
</pre>
      </article>

      <article>
          <h3>Google Closure compiled + soy demo</h3>

<pre>
/**
* @param {Array.<Array>} rawData
* @return {Array.<{name: string, address: string, www: string,
* email: string, leg_count: number}>}
*/
prezentacja.Model.prototype.importer = function(rawData) {
    var result = [];
    for(var i = 0; i < rawData.length; i++) {
        result[i] = {
            name: rawData[i]["name"],
            address: rawData[i]["address"],
            www: rawData[i]["www"],
            email: rawData[i]["email"],
            leg_count: parseInt(rawData[i]["leg_count"], 10)
        };
    }
    return result;
};
</pre>
      </article>

      <article>
          <h2>
              Compiled code = compiled names.<br>
              JSON comes from server and is not compiled!
          </h2>
      </article>

      <article>
          <h2>
              Write JSON importers to keep your code consistent. It's also a great server API documentation.
          </h2>
      </article>

      <article>
          <h3>Google Closure compiled + soy demo</h3>

<pre>
prezentacja.Loader.prototype.loadNewPageJSON = function(target) {
var xhr_ = new goog.net.XhrIo();

goog.events.listen(xhr_, goog.net.EventType.COMPLETE, function(e) {
var json = this.getResponseJson();

var translated_json = prezentacja.Model.getInstance().importer(json);
<span class="red">
target.innerHTML = prezentacja.templates.Table.table({
    data: translated_json
});
</span>
});

xhr_.send('/index/paginationjson');
};
</pre>
      </article>

      <article>
          <h3>Google Closure compiled + soy demo</h3>

<pre>
{namespace prezentacja.templates.Table}

/**
* @param data
*/
{template .table}
    {foreach $row in $data}
    &lt;tr class="{if index($row) % 2 == 0}even{else}odd{/if}"&gt;
        {call .renderrow}
        {param row: $row /}
        {/call}
    &lt;/tr&gt;
    {/foreach}
{/template}
</pre>
      </article>


      <article>
          <h3>Google Closure compiled + soy demo</h3>
<pre>
/**
* @param row
*/
{template .renderrow private="true"}
    &lt;td&gt;{$row.name}&lt;/td&gt;
    &lt;td&gt;{$row.address}&lt;/td&gt;
    &lt;td&gt;
        &lt;a href="{$row.www}"&gt;
            &lt;img src="/img/icons/icon_vcard.gif" alt="{$row.www}"&gt;
            {$row.www}
        &lt;/a&gt;
    &lt;/td&gt;
    ...
{/template}
</pre>
      </article>

      <article>
          <h2>Soy templates work with JavaScript and Java.</h2>
      </article>

	  <article>
		<h3>Plovr config - simple</h3>
<pre>
{
  "id": "prezentacja3",
  "paths": "src",
  "externs": [
    "externs/browser.js"
  ],
  "closure-library": "closure/closure/goog/",

  "inputs": "src/start-2.js",
<span class="red">
  "soy-function-plugins": "org.plovr.soy.function.PlovrModule",
</span>
  "mode": "ADVANCED",
  "level": "VERBOSE",

  "checks": {
    "deprecated": "ERROR",
    "checkTypes": "ERROR",
    "nonStandardJsDocs": "ERROR"
  }
}

</pre>
	  </article>

      <article>
          <h3>Everyone loves charts!</h3>
          <img class="centered big" style="margin-top: 50px !important; height: 50%;" src="images/total_initial_size.png">
      </article>

      <article>
          <h3>Everyone loves charts!</h3>
          <img class="centered big" style="margin-top: 50px !important; height: 50%;" src="images/total_initial_time.png">
      </article>

      <article>
          <h3>Everyone loves charts!</h3>
          <img class="centered big" style="margin-top: 50px !important; height: 50%;" src="images/total_page_size.png">
      </article>

      <article>
          <h3>Everyone loves charts!</h3>
          <img class="centered big" style="margin-top: 50px !important; height: 50%;" src="images/total_page_time.png">
      </article>

      <article>
          <h2>We don't have time to show...</h2>
      </article>

      <article>
          <h3>Closure Linter</h3>
<pre>
gjslint path/to/my/file.js

Line 46, E:0110: Line too long (87 characters).
Line 54, E:0214: Missing description in @return tag
Line 66, E:0012: Illegal semicolon after function declaration
Line 150, E:0120: Binary operator should go on previous line "+"
Line 175, E:0011: Missing semicolon after function assigned to a variable
Line 210, E:0121: Illegal comma at end of array literal
Line 220, E:0002: Missing space before ":"
</pre>
      </article>

      <article>
          <h3>Closure Stylesheets</h3>
          Variables:
<pre>
@def BG_COLOR              rgb(235, 239, 249);
@def DIALOG_BORDER_COLOR   rgb(107, 144, 218);
@def DIALOG_BG_COLOR       BG_COLOR;

body {
  background-color: BG_COLOR;
}

.dialog {
  background-color: DIALOG_BG_COLOR;
  border: 1px solid DIALOG_BORDER_COLOR;
}
</pre>

      </article>

      <article>
          <h3>Closure Stylesheets</h3>
          Functions:
<pre>
@def LEFT_HAND_NAV_WIDTH    180px;
@def LEFT_HAND_NAV_PADDING  3px;

.left_hand_nav {
  position: absolute;
  width: LEFT_HAND_NAV_WIDTH;
  padding: LEFT_HAND_NAV_PADDING;
}

.content {
  position: absolute;
  margin-left: add(LEFT_HAND_NAV_PADDING,  /* padding left */
                   LEFT_HAND_NAV_WIDTH,
                   LEFT_HAND_NAV_PADDING); /* padding right */
}
</pre>

      </article>

      <article>
          <h3>Closure Stylesheets - renaming!</h3>
          In JS:
<pre>
var element = goog.dom.getElementByClass(
    <span class="red">goog.getCssName('dialog-content')</span>
    );
</pre>
          In CSS:
<pre>
{template .dialog}
&lt;div class="<span class="red">{css dialog-content}</span>"&gt;
&lt;div class="{css dialog-title}">{$title}&lt;/title&gt;
    {call .content data="all" /}
&lt;/div&gt;
{/template}
</pre>

      </article>

      <article>
          <h3>Links</h3>

          <ul>
              <li><a href="http://plovr.com">Plovr website (do not build your own binary...)</a></li>
              <li><a href="https://developers.google.com/closure/">Google Closure</a></li>
              <li><a href="http://closure-library.googlecode.com/svn/trunk/closure/goog/demos/index.html">Closure Library UI demos</a></li>
              <li><a href="http://code.google.com/p/my-gae-template-py27/" class="red">Makefiles for Closure and GAE</a></li>
              <li><a href="http://www.limejs.com/">LimeJS game engine built with Closure and WebGL</a></li>
              <li><a href="http://jasongoemaat.blogspot.com/2011/07/building-plovr-on-windows.html">Building Plovr on Windows</a></li>
              <li><a href="https://groups.google.com/forum/?fromgroups#!topic/plovr/2amxkQXvMso">Plovr and Closure Stylesheets</a></li>
              <li><a href="http://www.normalesup.org/~simonet/soft/ow/eclipse-closure-javascript.en.html">Eclipse :-( plugin</a></li>
              <li><a href="http://plugins.intellij.net/plugin/?id=5830">IDEA Intellij :-) plugin</a></li>
          </ul>

      </article>

      <article>
        <div style="text-align:center">
          <h1>That's all folks!</h1>
          <br>
          <img src="images/smashinglabs.png"><br>
          <a href="http://www.smashinglabs.pl">www.smashinglabs.pl</a><br>
          <a href="https://twitter.com/#!/fridek">#fridek</a>
        </div>
      </article>   
    
      <article>
        <h2>Questions?</h2>
      </article>
  </body>
</html>
